# RAG-Flex Internationalization System

**[ç¹é«”ä¸­æ–‡](./I18N.zh-TW.md) | [æ—¥æœ¬èª](./I18N.ja.md)**

## ğŸŒ Dual-Layer Language Mechanism

RAG-Flex uses a **dual-layer language mechanism** to provide a truly multilingual experience:

### 1ï¸âƒ£ Configuration UI Language (System Auto-detected)
**Determined by system language**

- ğŸ” **Auto-detection**: Automatically detects system language when plugin starts
- ğŸ¨ **UI Display**: All configuration labels use the detected language
- ğŸ”„ **How to Switch**: Change your operating system language settings, then restart the plugin

**Examples:**
- System language is Traditional Chinese â†’ Configuration UI displays in Chinese
- System language is English â†’ Configuration UI displays in English

---

### 2ï¸âƒ£ Message Language (User Selectable)
**Selected by user in settings**

- âš™ï¸ **Configurable**: Choose "Message Language" in plugin settings
- ğŸ’¬ **Scope**: All runtime status messages, error messages, and LLM system prompts
- ğŸ”„ **Immediate Effect**: Changes apply immediately to new operations

**Examples:**
- System is English, but select "ç¹é«”ä¸­æ–‡ (zh-TW)"
  - Configuration UI: English âœ…
  - Runtime messages: Traditional Chinese âœ…

---

## ğŸ“Š Language Scope Comparison

| Component | Language Used | How to Switch | When Applied |
|-----------|--------------|---------------|--------------|
| **Configuration UI Labels** | System Language | Change system language + restart plugin | Plugin startup |
| **Message Language Selector** | System Language | Change system language + restart plugin | Plugin startup |
| **Other Config Labels** | System Language | Change system language + restart plugin | Plugin startup |
| **Status Messages** | Message Language | Select in settings | Immediately |
| **Error Messages** | Message Language | Select in settings | Immediately |
| **LLM System Prompts** | Message Language | Select in settings | Immediately |

---

## ğŸ¯ Use Cases

### Scenario 1: Fully Monolingual Environment
**Situation:** System is Traditional Chinese, want full Chinese experience

**Setup:**
1. âœ… System Language: Traditional Chinese
2. âœ… Message Language: Select "ç¹é«”ä¸­æ–‡ (zh-TW)"

**Result:**
- Configuration UI: Traditional Chinese
- Runtime Messages: Traditional Chinese

---

### Scenario 2: Mixed Language Environment
**Situation:** System is English, but want Chinese messages

**Setup:**
1. âœ… System Language: English
2. âœ… Message Language: Select "ç¹é«”ä¸­æ–‡ (zh-TW)"

**Result:**
- Configuration UI: English
- Runtime Messages: Traditional Chinese

---

### Scenario 3: Learning Mode
**Situation:** Want to see Chinese-English side-by-side for learning technical terms

**Setup:**
1. âœ… System Language: Any
2. âœ… Message Language: Switch to observe different language expressions

**Result:**
- Can switch message language anytime for comparative learning

---

## ğŸ”§ Technical Details

### Why Can't Configuration UI Switch Dynamically?

This is an **LM Studio SDK limitation**, not a design flaw:

```typescript
// Plugin lifecycle
export async function main(context: PluginContext) {
    // 1. Detect system language
    const systemLang = detectSystemLanguage();

    // 2. Generate configuration UI (using system language)
    const config = createDynamicConfig(models, systemLang);

    // 3. Register with LM Studio (configuration UI is now fixed)
    context.withConfigSchematics(config);
    //                          â†‘
    //                    Cannot be changed after this
}
```

**SDK Limitations:**
- `withConfigSchematics()` can only be called once
- Cannot dynamically update configuration UI after registration
- No API provided for "configuration UI re-rendering"

**Our Solution:**
- âœ… Configuration UI: Follows system language (true localization)
- âœ… Runtime Messages: User selectable (flexibility)
- âœ… Combined: Achieves optimal user experience

---

## ğŸŒ System Language Detection Mechanism

### Detection Order

1. **Environment variable `LANG`** (most common)
2. **Environment variable `LANGUAGE`** (fallback)
3. **Environment variable `LC_ALL`** (locale override)

### Detection Logic

```typescript
export function detectSystemLanguage(): SupportedLanguage {
    const envLang = process.env.LANG ||
                    process.env.LANGUAGE ||
                    process.env.LC_ALL || "";

    // Traditional Chinese (Taiwan, Hong Kong, Macau)
    if (envLang.includes("zh_TW") ||
        envLang.includes("zh-TW") ||
        envLang.includes("zh_HK")) {
        return "zh-TW";
    }

    // Japanese
    if (envLang.includes("ja") ||
        envLang.includes("jp")) {
        return "ja";
    }

    // Simplified Chinese (temporarily mapped to Traditional, future support)
    if (envLang.includes("zh_CN") ||
        envLang.includes("zh-CN")) {
        return "zh-TW";  // TODO: Add zh-CN support
    }

    // Default to English
    return "en";
}
```

---

## ğŸ”„ How to Change System Language

### Windows

1. **Settings** â†’ **Time & Language** â†’ **Language**
2. Add language or set as default
3. Restart application

**Environment Variable Setup (Advanced):**
```cmd
set LANG=zh_TW.UTF-8
set LANG=en_US.UTF-8
set LANG=ja_JP.UTF-8
```

---

### macOS

1. **System Preferences** â†’ **Language & Region**
2. Add or reorder preferred languages
3. Restart application

**Terminal Setup:**
```bash
export LANG=zh_TW.UTF-8
export LANG=en_US.UTF-8
export LANG=ja_JP.UTF-8
```

---

### Linux

**Temporary Setup (Current Session):**
```bash
export LANG=zh_TW.UTF-8
lms dev
```

**Permanent Setup:**
```bash
# Edit ~/.bashrc or ~/.zshrc
echo 'export LANG=zh_TW.UTF-8' >> ~/.bashrc
source ~/.bashrc
```

---

## ğŸ“ Message Language Settings

### In LM Studio

1. Open **LM Studio**
2. Go to **Plugin Settings**
3. Find **RAG-Flex** plugin
4. First setting:
   - English system: "**Message Language**"
   - Chinese system: "**è¨Šæ¯èªè¨€**"
   - Japanese system: "**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨€èª**"
5. Select desired language:
   - `English (en)`
   - `ç¹é«”ä¸­æ–‡ (zh-TW)`
   - `æ—¥æœ¬èª (ja)`

---

## âœ… Testing Language Switching

### Test Configuration UI Language

1. **Switch System Language** (Windows/macOS/Linux)
2. **Restart Plugin**:
   ```bash
   lms dev
   ```
3. **Check Configuration UI**: All labels should use system language

---

### Test Message Language

1. **In LM Studio**: Select different "Message Language"
2. **Upload Test File**
3. **Observe Status Messages**:

**Select English (en):**
```
Loading embedding model: bge-m3...
Retrieving relevant citations...
Retrieved 5 citations (threshold: 0.4)
```

**Select ç¹é«”ä¸­æ–‡ (zh-TW):**
```
è¼‰å…¥ Embedding æ¨¡å‹: bge-m3...
æ­£åœ¨æª¢ç´¢ç›¸é—œç‰‡æ®µ...
æˆåŠŸæª¢ç´¢åˆ° 5 å€‹ç›¸é—œç‰‡æ®µ (é–€æª»: 0.4)
```

**Select æ—¥æœ¬èª (ja):**
```
åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­: bge-m3...
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã«é–¢é€£ã™ã‚‹å¼•ç”¨ã‚’å–å¾—ä¸­...
5 ä»¶ã®é–¢é€£å¼•ç”¨ã‚’å–å¾—ã—ã¾ã—ãŸ (ã—ãã„å€¤: 0.4)
```

---

## ğŸ“ Best Practice Recommendations

### For General Users

**Recommended Configuration:**
- System Language = Message Language
- Keep both consistent for unified experience

---

### For Bilingual Users

**Recommended Configuration:**
- System Language = Primary working language
- Message Language = Flexible switching based on current task

**Advantages:**
- Stable configuration UI
- Runtime messages can switch as needed
- Learn Chinese-English technical terms side-by-side

---

### For Developers

**Testing Recommendations:**
1. Test all system language environments
2. Test all message language options
3. Verify configuration UI displays correctly
4. Verify runtime messages switch correctly

---

## ğŸ†˜ FAQ

### Q: Why doesn't the configuration UI change after switching "Message Language"?

**A:** This is designed behavior, not a bug.

- âœ… **Configuration UI**: Determined by system language (fixed at plugin startup)
- âœ… **Runtime Messages**: Determined by message language (switchable anytime)

To change configuration UI language, change system language and restart plugin.

---

### Q: How do I get a full Chinese experience?

**A:** Two-step setup:

1. **System Language**: Set to Traditional Chinese
2. **Message Language**: Select "ç¹é«”ä¸­æ–‡ (zh-TW)"

After restarting plugin, all content will be in Chinese.

---

### Q: Is Simplified Chinese supported?

**A:** Not yet, but planned for future versions.

- Currently supported: English, Traditional Chinese, Japanese
- Planned support: Simplified Chinese, Korean

For contributing Simplified Chinese translations, see `src/locales/README.md`.

---

### Q: Can I add other languages?

**A:** Yes! See:

- **Detailed Guide**: `src/locales/README.md`
- **Traditional Chinese**: `src/locales/README.zh-TW.md`
- **Japanese**: `src/locales/README.ja.md`

Adding a new language takes only 5 steps. Contributions welcome!

---

## ğŸ“š Related Documentation

- **Implementation Details**: [I18N_IMPLEMENTATION.md](./I18N_IMPLEMENTATION.md)
- **Quick Summary**: [SUMMARY.md](./SUMMARY.md)
- **Changelog**: [CHANGELOG_I18N.md](./CHANGELOG_I18N.md)
- **Translation File Maintenance**: [src/locales/README.md](../src/locales/README.md)
- **Traditional Chinese Guide**: [src/locales/README.zh-TW.md](../src/locales/README.zh-TW.md)
- **Japanese Guide**: [src/locales/README.ja.md](../src/locales/README.ja.md)

---

## ğŸ’¡ Design Philosophy

This dual-layer language mechanism is designed based on these principles:

1. **Respect System Settings**: Configuration UI follows system language
2. **Provide Flexibility**: Runtime messages are user-selectable
3. **True Localization**: Avoid mixed-language interfaces
4. **User-Friendly**: Clearly explain what each setting does

---

## ğŸ™ Acknowledgments

Thanks to the LM Studio team for providing an excellent plugin SDK that enables us to build this multilingual system.

---

*Last Updated: 2026-01-03*
*Version: v1.1.0*
